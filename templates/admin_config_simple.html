{% extends "base.html" %}

{% block title %}Manufacturer Configuration{% endblock %}
{% block header %}Manufacturer Configuration{% endblock %}

{% block content %}
<div class="card">
    <h2>Manufacturing Infrastructure Setup</h2>
    <p style="color: #6b7280; margin-bottom: 30px;">
        Configure your factory sections and machines. This data will be saved and used for all incoming customer orders.
    </p>

    <form action="{{ url_for('admin_config') }}" method="POST">
        
        <h3>Section 1 Configuration</h3>
        <div class="grid-2">
            <div class="form-group">
                <label for="s1_id">Section ID</label>
                <input type="number" id="s1_id" name="s1_id" value="{{ config.sections[0].section_id if config.sections else 1 }}" required>
            </div>
            <div class="form-group">
                <label for="s1_fixed_cost">Fixed Setup Cost ($)</label>
                <input type="number" id="s1_fixed_cost" name="s1_fixed_cost" step="0.01" value="{{ config.sections[0].fixed_setup_cost if config.sections else 500.0 }}" required>
            </div>
        </div>
        <div class="grid-2">
            <div class="form-group">
                <label for="s1_capacity">Capacity (max tasks)</label>
                <input type="number" id="s1_capacity" name="s1_capacity" value="{{ config.sections[0].capacity if config.sections else 9 }}" required>
            </div>
            <div class="form-group">
                <label for="s1_output_score">Output Score (optional)</label>
                <input type="number" id="s1_output_score" name="s1_output_score" step="0.01" value="{{ config.sections[0].output_score_optional if config.sections else 100.0 }}">
            </div>
        </div>

        <h3>Section 2 Configuration</h3>
        <div class="grid-2">
            <div class="form-group">
                <label for="s2_id">Section ID</label>
                <input type="number" id="s2_id" name="s2_id" value="{{ config.sections[1].section_id if config.sections and config.sections|length > 1 else 2 }}" required>
            </div>
            <div class="form-group">
                <label for="s2_fixed_cost">Fixed Setup Cost ($)</label>
                <input type="number" id="s2_fixed_cost" name="s2_fixed_cost" step="0.01" value="{{ config.sections[1].fixed_setup_cost if config.sections and config.sections|length > 1 else 900.0 }}" required>
            </div>
        </div>
        <div class="grid-2">
            <div class="form-group">
                <label for="s2_capacity">Capacity (max tasks)</label>
                <input type="number" id="s2_capacity" name="s2_capacity" value="{{ config.sections[1].capacity if config.sections and config.sections|length > 1 else 12 }}" required>
            </div>
            <div class="form-group">
                <label for="s2_output_score">Output Score (optional)</label>
                <input type="number" id="s2_output_score" name="s2_output_score" step="0.01" value="{{ config.sections[1].output_score_optional if config.sections and config.sections|length > 1 else 130.0 }}">
            </div>
        </div>

        <h3>Section 3 Configuration</h3>
        <div class="grid-2">
            <div class="form-group">
                <label for="s3_id">Section ID</label>
                <input type="number" id="s3_id" name="s3_id" value="{{ config.sections[2].section_id if config.sections and config.sections|length > 2 else 3 }}" required>
            </div>
            <div class="form-group">
                <label for="s3_fixed_cost">Fixed Setup Cost ($)</label>
                <input type="number" id="s3_fixed_cost" name="s3_fixed_cost" step="0.01" value="{{ config.sections[2].fixed_setup_cost if config.sections and config.sections|length > 2 else 600.0 }}" required>
            </div>
        </div>
        <div class="grid-2">
            <div class="form-group">
                <label for="s3_capacity">Capacity (max tasks)</label>
                <input type="number" id="s3_capacity" name="s3_capacity" value="{{ config.sections[2].capacity if config.sections and config.sections|length > 2 else 8 }}" required>
            </div>
            <div class="form-group">
                <label for="s3_output_score">Output Score (optional)</label>
                <input type="number" id="s3_output_score" name="s3_output_score" step="0.01" value="{{ config.sections[2].output_score_optional if config.sections and config.sections|length > 2 else 110.0 }}">
            </div>
        </div>

        <h3>Machine Configuration - Section 1</h3>
        <div style="background: #f9fafb; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
            <div class="grid-2">
                <div class="form-group">
                    <label>Machine 1 - Section 1 - Time per Task</label>
                    <input type="number" name="s1_m1_time" step="0.01" placeholder="Time per task" value="{{ config.machines_dict[(1,1)].time_per_task if config.machines_dict and (1,1) in config.machines_dict else '1.7' }}" required>
                </div>
                <div class="form-group">
                    <label>Available? (1=Yes, 0=No)</label>
                    <input type="number" name="s1_m1_avail" min="0" max="1" value="{{ config.machines_dict[(1,1)].available if config.machines_dict and (1,1) in config.machines_dict else '1' }}" required>
                </div>
            </div>
            <div class="grid-2">
                <div class="form-group">
                    <label>Machine 2 - Section 1 - Time per Task</label>
                    <input type="number" name="s1_m2_time" step="0.01" placeholder="Time per task" value="{{ config.machines_dict[(1,2)].time_per_task if config.machines_dict and (1,2) in config.machines_dict else '1.85' }}" required>
                </div>
                <div class="form-group">
                    <label>Available? (1=Yes, 0=No)</label>
                    <input type="number" name="s1_m2_avail" min="0" max="1" value="{{ config.machines_dict[(1,2)].available if config.machines_dict and (1,2) in config.machines_dict else '1' }}" required>
                </div>
            </div>
            <div class="grid-2">
                <div class="form-group">
                    <label>Machine 3 - Section 1 - Time per Task</label>
                    <input type="number" name="s1_m3_time" step="0.01" placeholder="Time per task" value="{{ config.machines_dict[(1,3)].time_per_task if config.machines_dict and (1,3) in config.machines_dict else '1.95' }}" required>
                </div>
                <div class="form-group">
                    <label>Available? (1=Yes, 0=No)</label>
                    <input type="number" name="s1_m3_avail" min="0" max="1" value="{{ config.machines_dict[(1,3)].available if config.machines_dict and (1,3) in config.machines_dict else '1' }}" required>
                </div>
            </div>
        </div>

        <h3>Machine Configuration - Section 2</h3>
        <div style="background: #f9fafb; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
            <div class="grid-2">
                <div class="form-group">
                    <label>Machine 1 - Section 2 - Time per Task</label>
                    <input type="number" name="s2_m1_time" step="0.01" placeholder="Time per task" value="{{ config.machines_dict[(2,1)].time_per_task if config.machines_dict and (2,1) in config.machines_dict else '2.0' }}" required>
                </div>
                <div class="form-group">
                    <label>Available? (1=Yes, 0=No)</label>
                    <input type="number" name="s2_m1_avail" min="0" max="1" value="{{ config.machines_dict[(2,1)].available if config.machines_dict and (2,1) in config.machines_dict else '1' }}" required>
                </div>
            </div>
            <div class="grid-2">
                <div class="form-group">
                    <label>Machine 2 - Section 2 - Time per Task</label>
                    <input type="number" name="s2_m2_time" step="0.01" placeholder="Time per task" value="{{ config.machines_dict[(2,2)].time_per_task if config.machines_dict and (2,2) in config.machines_dict else '2.1' }}" required>
                </div>
                <div class="form-group">
                    <label>Available? (1=Yes, 0=No)</label>
                    <input type="number" name="s2_m2_avail" min="0" max="1" value="{{ config.machines_dict[(2,2)].available if config.machines_dict and (2,2) in config.machines_dict else '0' }}" required>
                </div>
            </div>
            <div class="grid-2">
                <div class="form-group">
                    <label>Machine 3 - Section 2 - Time per Task</label>
                    <input type="number" name="s2_m3_time" step="0.01" placeholder="Time per task" value="{{ config.machines_dict[(2,3)].time_per_task if config.machines_dict and (2,3) in config.machines_dict else '2.15' }}" required>
                </div>
                <div class="form-group">
                    <label>Available? (1=Yes, 0=No)</label>
                    <input type="number" name="s2_m3_avail" min="0" max="1" value="{{ config.machines_dict[(2,3)].available if config.machines_dict and (2,3) in config.machines_dict else '1' }}" required>
                </div>
            </div>
            <div class="grid-2">
                <div class="form-group">
                    <label>Machine 4 - Section 2 - Time per Task</label>
                    <input type="number" name="s2_m4_time" step="0.01" placeholder="Time per task" value="{{ config.machines_dict[(2,4)].time_per_task if config.machines_dict and (2,4) in config.machines_dict else '2.2' }}" required>
                </div>
                <div class="form-group">
                    <label>Available? (1=Yes, 0=No)</label>
                    <input type="number" name="s2_m4_avail" min="0" max="1" value="{{ config.machines_dict[(2,4)].available if config.machines_dict and (2,4) in config.machines_dict else '1' }}" required>
                </div>
            </div>
        </div>

        <h3>Machine Configuration - Section 3</h3>
        <div style="background: #f9fafb; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
            <div class="grid-2">
                <div class="form-group">
                    <label>Machine 1 - Section 3 - Time per Task</label>
                    <input type="number" name="s3_m1_time" step="0.01" placeholder="Time per task" value="{{ config.machines_dict[(3,1)].time_per_task if config.machines_dict and (3,1) in config.machines_dict else '2.3' }}" required>
                </div>
                <div class="form-group">
                    <label>Available? (1=Yes, 0=No)</label>
                    <input type="number" name="s3_m1_avail" min="0" max="1" value="{{ config.machines_dict[(3,1)].available if config.machines_dict and (3,1) in config.machines_dict else '1' }}" required>
                </div>
            </div>
            <div class="grid-2">
                <div class="form-group">
                    <label>Machine 2 - Section 3 - Time per Task</label>
                    <input type="number" name="s3_m2_time" step="0.01" placeholder="Time per task" value="{{ config.machines_dict[(3,2)].time_per_task if config.machines_dict and (3,2) in config.machines_dict else '2.4' }}" required>
                </div>
                <div class="form-group">
                    <label>Available? (1=Yes, 0=No)</label>
                    <input type="number" name="s3_m2_avail" min="0" max="1" value="{{ config.machines_dict[(3,2)].available if config.machines_dict and (3,2) in config.machines_dict else '1' }}" required>
                </div>
            </div>
        </div>

        <h3>Cost Configuration</h3>
        <p style="color: #6b7280; font-size: 14px; margin-bottom: 15px;">
            Base variable cost per machine (will be calculated for tasks 1-10 automatically with small variations)
        </p>
        <div class="grid-2">
            <div class="form-group">
                <label>Section 1, Machine 1 - Base Cost ($)</label>
                <input type="number" name="s1_m1_cost" step="0.01" value="{{ config.base_costs[(1,1)] if config.base_costs and (1,1) in config.base_costs else '43.0' }}" required>
            </div>
            <div class="form-group">
                <label>Section 1, Machine 2 - Base Cost ($)</label>
                <input type="number" name="s1_m2_cost" step="0.01" value="{{ config.base_costs[(1,2)] if config.base_costs and (1,2) in config.base_costs else '46.0' }}" required>
            </div>
        </div>
        <div class="grid-2">
            <div class="form-group">
                <label>Section 1, Machine 3 - Base Cost ($)</label>
                <input type="number" name="s1_m3_cost" step="0.01" value="{{ config.base_costs[(1,3)] if config.base_costs and (1,3) in config.base_costs else '49.0' }}" required>
            </div>
            <div class="form-group">
                <label>Section 2, Machine 1 - Base Cost ($)</label>
                <input type="number" name="s2_m1_cost" step="0.01" value="{{ config.base_costs[(2,1)] if config.base_costs and (2,1) in config.base_costs else '48.0' }}" required>
            </div>
        </div>
        <div class="grid-2">
            <div class="form-group">
                <label>Section 2, Machine 2 - Base Cost ($)</label>
                <input type="number" name="s2_m2_cost" step="0.01" value="{{ config.base_costs[(2,2)] if config.base_costs and (2,2) in config.base_costs else '51.0' }}" required>
            </div>
            <div class="form-group">
                <label>Section 2, Machine 3 - Base Cost ($)</label>
                <input type="number" name="s2_m3_cost" step="0.01" value="{{ config.base_costs[(2,3)] if config.base_costs and (2,3) in config.base_costs else '54.0' }}" required>
            </div>
        </div>
        <div class="grid-2">
            <div class="form-group">
                <label>Section 2, Machine 4 - Base Cost ($)</label>
                <input type="number" name="s2_m4_cost" step="0.01" value="{{ config.base_costs[(2,4)] if config.base_costs and (2,4) in config.base_costs else '57.0' }}" required>
            </div>
            <div class="form-group">
                <label>Section 3, Machine 1 - Base Cost ($)</label>
                <input type="number" name="s3_m1_cost" step="0.01" value="{{ config.base_costs[(3,1)] if config.base_costs and (3,1) in config.base_costs else '56.0' }}" required>
            </div>
        </div>
        <div class="grid-2">
            <div class="form-group">
                <label>Section 3, Machine 2 - Base Cost ($)</label>
                <input type="number" name="s3_m2_cost" step="0.01" value="{{ config.base_costs[(3,2)] if config.base_costs and (3,2) in config.base_costs else '59.0' }}" required>
            </div>
            <div class="form-group">
                <label>Default Cost Limit ($)</label>
                <input type="number" name="default_cost_limit" step="0.01" value="{{ config.settings.default_cost_limit if config.settings and config.settings.default_cost_limit else '4200.0' }}" required>
            </div>
        </div>

        <div style="margin-top: 30px; text-align: center;">
            <button type="submit" class="btn btn-primary">Save Configuration</button>
            <a href="{{ url_for('admin_dashboard') }}" class="btn btn-secondary">Cancel</a>
        </div>
    </form>
</div>

<div class="card" style="background: #fffbeb; border-left: 4px solid #f59e0b;">
    <h3 style="color: #92400e; margin-top: 0;">Important Notes</h3>
    <ul style="color: #78350f; padding-left: 20px;">
        <li>This configuration is saved once and used for all customer orders automatically.</li>
        <li>Set Available=0 for machines that are currently down or unavailable.</li>
        <li>Base costs will be automatically expanded to cover tasks 1-10 with small variations.</li>
        <li>You can update this configuration anytime - new orders will use the updated values.</li>
        <li>Already-processed orders retain their original configuration snapshot.</li>
    </ul>
</div>
{% endblock %}
